# üîç –ö–û–†–†–ï–ö–¶–ò–Ø –ê–ù–ê–õ–ò–ó–ê –õ–û–ì–û–í ERNI-KI

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –ø–æ–¥—Å—á—ë—Ç–∞ –æ—à–∏–±–æ–∫

**–î–∞—Ç–∞:** 2025-11-04  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ 4 "–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ" –ø—Ä–æ–±–ª–µ–º—ã –æ–∫–∞–∑–∞–ª–∏—Å—å –õ–û–ñ–ù–´–ú–ò –¢–†–ï–í–û–ì–ê–ú–ò

---

## üìã EXECUTIVE SUMMARY

### –ü—Ä–æ–±–ª–µ–º–∞ —Å –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–µ–π

–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∫–æ–º–∞–Ω–¥—É:

```bash
docker logs <container> --since 24h 2>&1 | grep -iE "error|warn" | wc -l
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –ª–æ–≤–∏—Ç:

- ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ ERROR/WARN —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚ùå INFO –ª–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —Å–ª–æ–≤–∞ "error", "warn", "warning" –≤ —Ç–µ–∫—Å—Ç–µ
- ‚ùå JSON –ª–æ–≥–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–≤ —Å–ª—É—á–∞–µ Fluent Bit)
- ‚ùå –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (connection reset by peer)

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏

| –°–µ—Ä–≤–∏—Å               | –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ | –†–µ–∞–ª—å–Ω–æ      | –°—Ç–∞—Ç—É—Å                |
| -------------------- | ------------- | ------------ | --------------------- |
| **webhook-receiver** | 7,114         | 656 CRITICAL | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è   |
| **node-exporter**    | 36,405        | 0            | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| **SearXNG**          | 1,204         | 1            | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| **Fluent Bit**       | 1,178         | 0            | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| **–ò–¢–û–ì–û**            | **46,154**    | **657**      | **-98.6% –æ—à–∏–±–æ–∫**     |

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ü–û –°–ï–†–í–ò–°–ê–ú

### 1. Webhook-receiver: 7,114 ‚Üí 656 –æ—à–∏–±–æ–∫

**–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç:**

```bash
docker logs erni-ki-webhook-receiver --since 24h 2>&1 | grep -iE "error|warn" | wc -l
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 7,114
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∞–Ω–¥–∞ –ª–æ–≤–∏—Ç INFO –ª–æ–≥–∏ —Å —Ç–µ–∫—Å—Ç–æ–º "Processing **warn**ing alert":

```
2025-11-04 07:39:53,208 - webhook-receiver - INFO - Processing warning alert:
2025-11-04 07:39:53,208 - webhook-receiver - INFO -   Severity: warning
```

**–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç:**

```bash
docker logs erni-ki-webhook-receiver --since 24h 2>&1 | grep -E "ERROR|CRITICAL|Exception|Traceback" | wc -l
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 656
```

**–†–µ–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏:**

```
2025-11-03 08:05:22,329 - webhook-receiver - CRITICAL - üö® CRITICAL ALERT for service: unknown
2025-11-03 08:05:33,036 - webhook-receiver - CRITICAL - üö® CRITICAL ALERT for service: redis
2025-11-03 08:06:04,278 - webhook-receiver - CRITICAL - üö® CRITICAL ALERT for service: system
```

**–í—ã–≤–æ–¥:**

- ‚úÖ –°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (healthy)
- ‚ö†Ô∏è 656 CRITICAL –∞–ª–µ—Ä—Ç–æ–≤ –æ—Ç Prometheus Alertmanager (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - —Å–µ—Ä–≤–∏—Å
  –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–ª–µ—Ä—Ç—ã)
- üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ò–∑–º–µ–Ω–∏—Ç—å `LOG_LEVEL=WARNING` –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è verbose –ª–æ–≥–æ–≤

---

### 2. Node-exporter: 36,405 ‚Üí 0 –æ—à–∏–±–æ–∫

**–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç:**

```bash
docker logs erni-ki-node-exporter --since 24h 2>&1 | grep -iE "error|warn" | wc -l
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 36,405
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∞–Ω–¥–∞ –ª–æ–≤–∏—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è "connection reset by peer":

```
time=2025-11-04T07:15:54.274Z level=ERROR source=http.go:219 msg="error encoding and sending metric family: write tcp 127.0.0.1:9100->127.0.0.1:59148: write: connection reset by peer"
```

**Root Cause:**

- Prometheus –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–∏ scrape –º–µ—Ç—Ä–∏–∫
- –≠—Ç–æ **–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å** node-exporter
- –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–º–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

**–£–∂–µ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

```yaml
# compose.yml
command:
  - "--log.level=error"  # –£–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

# conf/prometheus/prometheus.yml
- job_name: "node-exporter"
  scrape_interval: 30s
  scrape_timeout: 25s  # –£–≤–µ–ª–∏—á–µ–Ω —Å 15s –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è broken pipe
```

**–í—ã–≤–æ–¥:**

- ‚úÖ –°–µ—Ä–≤–∏—Å healthy
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

### 3. SearXNG: 1,204 ‚Üí 1 –æ—à–∏–±–∫–∞

**–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç:**

```bash
docker logs erni-ki-searxng-1 --since 24h 2>&1 | grep -iE "error|warn" | wc -l
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 1,204
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∞–Ω–¥–∞ –ª–æ–≤–∏—Ç INFO –ª–æ–≥–∏ —Å —É—Ä–æ–≤–Ω–µ–º "**WARN**ING" –æ—Ç rate limiter:

```
2025-11-04 07:03:35,068 WARNING:searx.limiter: PASS 127.0.0.1/32: matched PASSLIST - IP matches 127.0.0.0/8 in botdetection.ip_lists.pass_ip.
2025-11-04 07:03:41,489 WARNING:searx.limiter: PASS 172.19.0.1/32: matched PASSLIST - IP matches 172.16.0.0/12 in botdetection.ip_lists.pass_ip.
```

**–ó–Ω–∞—á–µ–Ω–∏–µ:** IP –∞–¥—Ä–µ—Å–∞ (127.0.0.1 –∏ 172.19.0.1) –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ **PASSLIST** –∏
**—Ä–∞–∑—Ä–µ—à–µ–Ω—ã** (–Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è). –≠—Ç–æ **–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**.

**–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç:**

```bash
docker logs erni-ki-searxng-1 --since 24h 2>&1 | grep -E "ERROR|CRITICAL|Exception|Failed" | wc -l
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 1
```

**–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:**

```
2025-11-04 03:00:41,489 ERROR:searx.botdetection: X-Forwarded-For nor X-Real-IP header is set!
```

**–í—ã–≤–æ–¥:**

- ‚úÖ –°–µ—Ä–≤–∏—Å healthy
- ‚úÖ Rate limiter —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚ÑπÔ∏è 1 –æ—à–∏–±–∫–∞ –æ missing X-Forwarded-For header (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

---

### 4. Fluent Bit: 1,178 ‚Üí 0 –æ—à–∏–±–æ–∫

**–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç:**

```bash
docker logs erni-ki-fluent-bit --since 24h 2>&1 | grep -iE "error|warn" | wc -l
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 1,178
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∞–Ω–¥–∞ –ª–æ–≤–∏—Ç **JSON-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**,
–∫–æ—Ç–æ—Ä—ã–µ Fluent Bit —Å–æ–±–∏—Ä–∞–µ—Ç:

```json
{
  "date": 1762239845.0,
  "log": "2025-11-04 07:04:05,116 WARNING:searx.limiter: PASS 127.0.0.1/32: matched PASSLIST - IP matches 127.0.0.0/8 in botdetection.ip_lists.pass_ip.",
  "container_id": "b210f48349ef...",
  "container_name": "/erni-ki-searxng-1",
  "source": "stderr"
}
```

**–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç:**

```bash
docker logs erni-ki-fluent-bit --since 24h 2>&1 | grep -v "^{" | grep -iE "error|warn" | wc -l
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 0
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ Loki:**

```bash
curl -s -H "X-Scope-OrgID: erni-ki" http://localhost:3100/ready
# –†–µ–∑—É–ª—å—Ç–∞—Ç: ready
```

**–í—ã–≤–æ–¥:**

- ‚úÖ Fluent Bit —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Loki –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

---

## üìä –û–ë–ù–û–í–õ–Å–ù–ù–´–ï –ú–ï–¢–†–ò–ö–ò

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–ü–û–°–õ–ï –ö–û–†–†–ï–ö–¶–ò–ò)

| –ú–µ—Ç—Ä–∏–∫–∞                   | –ó–Ω–∞—á–µ–Ω–∏–µ         | –û—Ü–µ–Ω–∫–∞             |
| ------------------------- | ---------------- | ------------------ |
| **–û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö (24—á)**  | 657              | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å |
| **Unhealthy –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**  | 0                | ‚úÖ –û—Ç–ª–∏—á–Ω–æ         |
| **–í–∞–ª–∏–¥–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** | 29/30 (96.7%)    | ‚ö†Ô∏è –•–æ—Ä–æ—à–æ          |
| **Latest —Ç–µ–≥–∏**           | 23 –æ–±—Ä–∞–∑–∞        | ‚ùå –ü–ª–æ—Ö–æ           |
| **pg_stat_statements**    | –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω    | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç     |
| **Hardcoded —Å–µ–∫—Ä–µ—Ç—ã**     | 6,030 —É–ø–æ–º–∏–Ω–∞–Ω–∏–π | ‚ùå –ö—Ä–∏—Ç–∏—á–Ω–æ        |
| **Docker Security**       | 0/4 –ø—Ä–∞–∫—Ç–∏–∫      | ‚ùå –ù–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ    |
| **CPU –∑–∞–≥—Ä—É–∑–∫–∞**          | 10.8%            | ‚úÖ –û—Ç–ª–∏—á–Ω–æ         |
| **RAM –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**     | 33.5%            | ‚úÖ –û—Ç–ª–∏—á–Ω–æ         |
| **GPU —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è**        | 1-3%             | ‚úÖ –ù–∏–∑–∫–∞—è          |
| **Disk –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**    | 62%              | ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ       |

**–û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞:** 78/100 (‚ö†Ô∏è –•–û–†–û–®–û) - —É–ª—É—á—à–µ–Ω–∏–µ —Å 68/100

---

## üéØ –û–ë–ù–û–í–õ–Å–ù–ù–´–ô –ü–†–ò–û–†–ò–¢–ò–ó–ò–†–û–í–ê–ù–ù–´–ô –ü–õ–ê–ù

### ~~–§–∞–∑–∞ 1: –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø~~ ‚úÖ –û–¢–ú–ï–ù–ï–ù–ê

–í—Å–µ 4 "–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ" –ø—Ä–æ–±–ª–µ–º—ã –æ–∫–∞–∑–∞–ª–∏—Å—å –ª–æ–∂–Ω—ã–º–∏ —Ç—Ä–µ–≤–æ–≥–∞–º–∏:

- ~~Webhook-receiver: 7,114 –æ—à–∏–±–æ–∫~~ ‚Üí 656 CRITICAL –∞–ª–µ—Ä—Ç–æ–≤ (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- ~~Node-exporter: 36,405 –æ—à–∏–±–æ–∫~~ ‚Üí 0 —Ä–µ–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫
- ~~SearXNG: 1,204 –æ—à–∏–±–∫–∏~~ ‚Üí 1 –æ—à–∏–±–∫–∞ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
- ~~Fluent Bit: 1,178 –æ—à–∏–±–æ–∫~~ ‚Üí 0 —Ä–µ–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫

---

### –§–∞–∑–∞ 2: –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (24-48 —á–∞—Å–æ–≤)

| #   | –ü—Ä–æ–±–ª–µ–º–∞                        | Severity | –í—Ä–µ–º—è  | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
| --- | ------------------------------- | -------- | ------ | --------- |
| 1   | PostgreSQL: pg_stat_statements  | HIGH     | 30 –º–∏–Ω | 1         |
| 2   | Backrest: config.json –Ω–µ–≤–∞–ª–∏–¥–µ–Ω | HIGH     | 30 –º–∏–Ω | 2         |

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 1 —á–∞—Å  
**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ë–î –∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –±—ç–∫–∞–ø—ã

---

### –§–∞–∑–∞ 3: –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (1-2 –Ω–µ–¥–µ–ª–∏)

| #   | –ü—Ä–æ–±–ª–µ–º–∞                       | Severity | –í—Ä–µ–º—è  | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
| --- | ------------------------------ | -------- | ------ | --------- |
| 3   | Prometheus endpoint –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | MEDIUM   | 15 –º–∏–Ω | 3         |
| 4   | 23 –æ–±—Ä–∞–∑–∞ —Å latest —Ç–µ–≥–∞–º–∏      | MEDIUM   | 2-3 —á  | 3         |
| 5   | 116 –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤            | MEDIUM   | 1-2 —á  | 3         |
| 6   | 6,030 —É–ø–æ–º–∏–Ω–∞–Ω–∏–π —Å–µ–∫—Ä–µ—Ç–æ–≤      | MEDIUM   | 4-8 —á  | 3         |
| 7   | Docker Security Best Practices | MEDIUM   | 4-6 —á  | 3         |

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 12-20 —á–∞—Å–æ–≤

---

### –§–∞–∑–∞ 4: –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ)

| #   | –ü—Ä–æ–±–ª–µ–º–∞                            | Severity | –í—Ä–µ–º—è    | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
| --- | ----------------------------------- | -------- | -------- | --------- |
| 8   | ragflow-es-01: 60.59% –ø–∞–º—è—Ç–∏        | MEDIUM   | 30 –º–∏–Ω   | 4         |
| 9   | ShellCheck –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω            | LOW      | 15 –º–∏–Ω + | 4         |
| 10  | Trivy –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω                 | LOW      | 15 –º–∏–Ω + | 4         |
| 11  | Webhook-receiver: LOG_LEVEL=WARNING | LOW      | 5 –º–∏–Ω    | 4         |

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 1+ —á–∞—Å

---

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ –ú–ï–¢–û–î–û–õ–û–ì–ò–ò

### 1. –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –æ—à–∏–±–æ–∫

**–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–µ—Ä–≤–∏—Å–æ–≤:**

```bash
docker logs <container> --since 24h 2>&1 | grep -E "ERROR|CRITICAL|Exception|Traceback" | wc -l
```

**–î–ª—è Fluent Bit (–∏—Å–∫–ª—é—á–∏—Ç—å JSON –ª–æ–≥–∏):**

```bash
docker logs erni-ki-fluent-bit --since 24h 2>&1 | grep -v "^{" | grep -E "ERROR|CRITICAL" | wc -l
```

**–î–ª—è node-exporter (–∏—Å–∫–ª—é—á–∏—Ç—å connection reset):**

```bash
docker logs erni-ki-node-exporter --since 24h 2>&1 | grep -E "ERROR|CRITICAL" | grep -v "connection reset by peer" | wc -l
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç `scripts/monitoring/count-real-errors.sh`:

```bash
#!/bin/bash
# –ü–æ–¥—Å—á—ë—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö ERNI-KI

echo "=== ERNI-KI Real Errors Count ==="
echo "Date: $(date)"
echo ""

# Webhook-receiver (—Ç–æ–ª—å–∫–æ CRITICAL/ERROR)
echo "webhook-receiver: $(docker logs erni-ki-webhook-receiver --since 24h 2>&1 | grep -E 'ERROR|CRITICAL|Exception' | wc -l)"

# Node-exporter (–∏—Å–∫–ª—é—á–∏—Ç—å connection reset)
echo "node-exporter: $(docker logs erni-ki-node-exporter --since 24h 2>&1 | grep -E 'ERROR|CRITICAL' | grep -v 'connection reset by peer' | wc -l)"

# SearXNG (—Ç–æ–ª—å–∫–æ ERROR/CRITICAL)
echo "searxng: $(docker logs erni-ki-searxng-1 --since 24h 2>&1 | grep -E 'ERROR|CRITICAL|Exception' | wc -l)"

# Fluent Bit (–∏—Å–∫–ª—é—á–∏—Ç—å JSON –ª–æ–≥–∏)
echo "fluent-bit: $(docker logs erni-ki-fluent-bit --since 24h 2>&1 | grep -v '^{' | grep -E 'ERROR|CRITICAL' | wc -l)"

# OpenWebUI
echo "openwebui: $(docker logs erni-ki-openwebui --since 24h 2>&1 | grep -E 'ERROR|CRITICAL|Exception' | wc -l)"

# Nginx (—Ç–æ–ª—å–∫–æ error level)
echo "nginx: $(docker logs erni-ki-nginx-1 --since 24h 2>&1 | grep -E '\[error\]|\[crit\]|\[alert\]|\[emerg\]' | wc -l)"

# PostgreSQL
echo "postgres: $(docker logs erni-ki-db-1 --since 24h 2>&1 | grep -E 'ERROR|FATAL|PANIC' | wc -l)"

# Ollama
echo "ollama: $(docker logs erni-ki-ollama-1 --since 24h 2>&1 | grep -E 'ERROR|CRITICAL|Exception' | wc -l)"
```

### 3. Prometheus –∞–ª–µ—Ä—Ç—ã –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫

–î–æ–±–∞–≤–∏—Ç—å –≤ `conf/prometheus/alert_rules.yml`:

```yaml
- alert: HighRealErrorRate
  expr: rate(container_log_errors_total{level=~"ERROR|CRITICAL"}[5m]) > 10
  for: 5m
  labels:
    severity: warning
  annotations:
    summary: 'High real error rate in {{ $labels.container_name }}'
    description:
      'Container {{ $labels.container_name }} has {{ $value }} real errors per
      second'
```

---

## üìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

### –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

1. **–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –∫—Ä–∏—Ç–∏—á–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ grep –ø—Ä–∏–≤–µ–ª–∞ –∫ –∑–∞–≤—ã—à–µ–Ω–∏—é
   –æ—à–∏–±–æ–∫ –Ω–∞ **98.6%**
2. **–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞:** –†–µ–∞–ª—å–Ω–æ —Ç–æ–ª—å–∫–æ 657 –æ—à–∏–±–æ–∫ –≤–º–µ—Å—Ç–æ 46,154
3. **–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã healthy:** 0 unhealthy –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
4. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏–∑–º–µ–Ω–∏–ª–∏—Å—å:** –§–∞–∑–∞ 1 (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è) –æ—Ç–º–µ–Ω–µ–Ω–∞

### –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Å–∏—Å—Ç–µ–º—ã

**–î–æ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏:** 68/100 (‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –£–õ–£–ß–®–ï–ù–ò–ï)  
**–ü–æ—Å–ª–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏:** 78/100 (‚ö†Ô∏è –•–û–†–û–®–û)  
**–£–ª—É—á—à–µ–Ω–∏–µ:** +10 –±–∞–ª–ª–æ–≤

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ **–§–∞–∑–∞ 2 (24-48 —á–∞—Å–æ–≤):**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pg_stat_statements
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å Backrest config.json

2. ‚è≥ **–§–∞–∑–∞ 3 (1-2 –Ω–µ–¥–µ–ª–∏):**
   - –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏–∏ Docker –æ–±—Ä–∞–∑–æ–≤
   - –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Å–µ–∫—Ä–µ—Ç—ã, –ø–æ—Ä—Ç—ã)
   - Docker Security Best Practices

3. üí° **–§–∞–∑–∞ 4 (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ):**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ShellCheck –∏ Trivy
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á—ë—Ç–∞**
